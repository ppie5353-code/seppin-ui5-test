<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>UI5 GET/POST Proxy Test</title>
    <script id="sap-ui-bootstrap"
        src="https://ui5.sap.com/resources/sap-ui-core.js"
        data-sap-ui-theme="sap_horizon"
        data-sap-ui-libs="sap.m"
        data-sap-ui-async="true">
    </script>

    <script>
        var sData = {
            "UserName": "seeeeeppppp",
            "FirstName": "Willie",
            "LastName": "Ashmore",
            "MiddleName": null,
            "Age": null,
            "Emails": [],
            "Features": [],
            "AddressInfo": [],
            "HomeAddress": null
        };
        
        window.onload = function() {
            sap.ui.getCore().attachInit(function() {
                
                // 1. 입력 필드
                var oInput = new sap.m.Input({
                    placeholder: "https://your-proxy.com/api/test",
                    width: "100%",
                    value: "https://services.odata.org/TripPinRESTierService/(S(testsid))/People" 
                });

                // 1-1. POST 데이터 입력창 (수정됨: JSON 객체를 문자열로 변환하여 삽입)
                var oResultTextPost = new sap.m.TextArea({
                    width: "100%",
                    rows: 12,
                    editable: true,
                    placeholder: "POST 데이터를 JSON 형식으로 입력해주세요",
                    value: JSON.stringify(sData, null, 2) // 예쁘게 들여쓰기된 문자열로 변환
                });

                // 2. 결과 출력창
                var oResultText = new sap.m.TextArea({
                    width: "100%",
                    rows: 15,
                    editable: false,
                    placeholder: "결과가 여기에 표시됩니다."
                });

                // --- 통신 로직 함수 ---
                var fnCallProxy = function(sMethod) {
                    var sUrl = oInput.getValue();
                    if (!sUrl) {
                        sap.m.MessageToast.show("URL을 입력해주세요.");
                        return;
                    }

                    oResultText.setValue(sMethod + " 호출 중...");

                    var oSettings = {
                        url: sUrl,
                        method: sMethod,
                        success: function(data) {
                            oResultText.setValue("--- " + sMethod + " 성공 ---\n" + JSON.stringify(data, null, 2));
                            sap.m.MessageToast.show(sMethod + " 성공!");
                        },
                        error: function(err) {
                            oResultText.setValue("--- " + sMethod + " 실패 ---\n코드: " + err.status + "\n내용: " + err.statusText);
                            sap.m.MessageToast.show(sMethod + " 실패!");
                        }
                    };

                    // POST일 경우에만 페이로드 추가 (수정됨: 화면의 텍스트를 그대로 가져와서 전송)
                    if (sMethod === "POST") {
                        oSettings.contentType = "application/json";
                        oSettings.data = oResultTextPost.getValue(); // TextArea의 문자열 값을 통째로 전송
                    }

                    $.ajax(oSettings);
                };

                // 3. 버튼들 (가로 배치)
                var oBtnGet = new sap.m.Button({
                    text: "GET 호출",
                    type: "Default",
                    press: function() { fnCallProxy("GET"); }
                });

                var oBtnPost = new sap.m.Button({
                    text: "POST 호출",
                    type: "Emphasized",
                    press: function() { fnCallProxy("POST"); }
                });

                var oButtonBox = new sap.m.HBox({
                    items: [oBtnGet, oBtnPost],
                    gap: "10px"
                }).addStyleClass("sapUiSmallMarginBottom");

                // 4. 레이아웃 조립 (수정됨: oResultTextPost가 화면에 보이도록 추가)
                var oVBox = new sap.m.VBox({
                    items: [
                        new sap.m.Label({ text: "프록시 URL:", design: "Bold" }),
                        oInput,
                        new sap.m.Label({ text: "POST 페이로드 (직접 수정 가능):", design: "Bold" }).addStyleClass("sapUiSmallMarginTop"),
                        oResultTextPost, // 화면에 POST 데이터 입력창 추가
                        new sap.m.Label({ text: "액션:", design: "Bold" }).addStyleClass("sapUiSmallMarginTop"),
                        oButtonBox,
                        new sap.m.Label({ text: "응답 결과:", design: "Bold" }),
                        oResultText
                    ]
                }).addStyleClass("sapUiSmallMargin");

                // 5. 화면 표시
                new sap.m.Shell({
                    app: new sap.m.App({
                        pages: [
                            new sap.m.Page({
                                title: "UI5 Proxy Multi-Test (GET/POST)",
                                content: [oVBox]
                            })
                        ]
                    })
                }).placeAt("content");
            });
        };
    </script>
</head>
<body class="sapUiBody" id="content">
</body>
</html>
